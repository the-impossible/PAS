{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block title %} Supervisors
{% endblock %}
{% block head %}
{% include "partials/auth_head.html" %}
{%endblock %}
{% block body %}
<div class="app">
    {% include "partials/auth_nav.html" %}
    <div class="app-wrapper">
	    <div class="app-content pt-3 p-md-3 p-lg-4">
		    <div class="container-xl">
			    <div class="row g-3 mb-4 align-items-center justify-content-between">
				    <div class="col-auto">
						<h1 class="app-page-title mb-0">
                            <a href="{% url 'auth:department' dept.pk %}" class="btn btn-secodary"><i class="fa fa-arrow-left"></i></a>
                             {{ dept }} Dashboard
                        </h1>
				    </div>
				    <div class="col-auto">
					     <div class="page-utilities">
						    <div class="row g-2 justify-content-start justify-content-md-end align-items-center">
							    <div class="col-auto">
								    <a class="btn app-btn-primary" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#addSuperModal">
									    <i class="fa fa-plus"></i>
									    Add Supervisor
									</a>
                                    <a class="btn app-btn-secondary   " style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#addSuperMultipleModal">
									    <i class="fa fa-upload"></i>
									    Add From File
									</a>
							    </div>
						    </div><!--//row-->
					    </div><!--//table-utilities-->
				    </div><!--//col-auto-->
			    </div><!--//row-->

				<div class="col-lg-12 grid-margin stretch-card">
					<div class="card">
					  <div class="card-body">
						<h4 class="card-title text-center">{{dept}} Supervisors</h4>
						<hr class="w-75 mx-auto">
						<div class="app-card-body">
							<div class="table-responsive">
							  <table class="table app-table-hover mb-0 text-left table-sm table-striped table-bordered" id="table_id">
								<thead class="table-secondary">
									<tr>
										<th class="cell">#</th>
										<th class="cell">User ID</th>
										<th class="cell">Supervisor's Name</th>
										<th class="cell">Rank ID</th>
										<th class="cell">Email</th>
										<th class="cell">Phone</th>
									</tr>
								</thead>
								<tbody>
									{% if messages %}
									<tr id="remove">
										<td colspan="8">
										{% include "partials/messages.html" %}
										</td>
									</tr>
									{% endif %}

									{% if object_list.count > 0 %}
										{% for user in object_list  %}
										<tr>
											<td class="cell">{{ forloop.counter }}</td>
											<td class="cell">{{ user.user_id.username  }}</td>
											<td class="cell">{{ user.user_id.get_fullname }}</td>
											<td class="cell">{{ user.rank_id }}</td>
											<td class="cell">
												{% if user.user_id.email  %}
												<a href="mailto:{{ user.user_id.email }}">{{ user.user_id.email|truncatechars:20 }}</a>
												{% else %}
												<span class="badge bg-warning">NOT SET</span>
												{% endif %}
											</td>
											<td class="cell">
												{% if user.user_id.phone  %}
													<a href="tel:{{ user.user_id.phone }}">{{ user.user_id.phone }}</a>
												{% else %}
													<span class="badge bg-warning">NOT SET</span>
												{% endif %}
											</td>
											{% comment %}
											<td class="cell">{{ user.prog_id }}</td>
											<td class="cell">
												<i class="fa
													{% if user.user_id.is_active %}
														fa-check text-success
													{% else %}
														fa-times text-danger
													{% endif %}
												"></i>
											</td>
											<td>
												<button class="btn btn-danger btn-sm text-white" hx-get="{% url 'auth:delete_user' user.user_id.user_id %}" hx-target="#deleteUser">
													<i class="fa fa-trash "></i> Delete
												</button>
											</td>
											{% endcomment %}
										</tr>
										{% endfor %}
										{% else %}
									<tr>
										<td colspan="8">
											<div class="jumbotron text-center p-5   ">
												<!-- illustration can be used here too -->
												<p style="font-size: 5em;">ðŸ“‚</p> <br>
												<p style="font-size: 2em; margin-top: -40px;">No Supervisor Record Here!</p>
											</div>
										</td>
									</tr>
									{% endif %}
								</tbody>
							  </table>
							</div>
						</div>
					  </div>
					</div>
				</div>

		    </div><!--//container-fluid-->
	    </div><!--//app-content-->
	    {% include 'partials/auth_footer.html' %}
		{% include "partials/modal_logout.html" %}
    </div><!--//app-wrapper-->
    <!-- Javascript -->
	{% include "partials/auth_script.html" %}
</div>

<div class="modal fade" id="addSuperModal" style="display: none;" aria-hidden="true">
	<div class="modal-dialog" id="uploadDialog" role="document" hx-target="this">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Add Supervisor</h5>
				<button type="button" class="close btn btn-secondary" data-bs-dismiss="modal"><span>Ã—</span>
				</button>
			</div>
			<form method="post">
				<div class="modal-body">
					<p>Fill the form below to create a supervisor account.</p>
					<div id='form-errors'>{{ form_errors }}</div>
					<div class="row">
						<div class="col-6">
							{{ form1.username|as_crispy_field }}
						</div>
						<div class="col-6">
							{{ form1.name|as_crispy_field }}
						</div>
						<div class="col-6">
							{{ form1.phone|as_crispy_field }}
						</div>
						<div class="col-6">
							{{ form1.email|as_crispy_field }}
						</div>
						<div class="col-6">
							{{ form2.rank_id|as_crispy_field }}
						</div>
						<div class="col-6">
							{{ form2.prog_id|as_crispy_field }}
						</div>
						<div class="col-6">
							{{ form2.title|as_crispy_field }}
						</div>
						<div class="col-6">
							{{ form2.RG_capacity|as_crispy_field }}
						</div>
						<div class="col-6">
							{{ form2.Eve_capacity|as_crispy_field }}
						</div>
						<div class="col-6 mt-4">
							{{ form2.super_nd|as_crispy_field }}
						</div>
					</div>
					{% csrf_token %}
				</div>
				<div class="modal-footer">
					<button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
					<button type="submit" name="single" class="btn btn-success btn-block text-white">Create Account</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="modal fade" id="addSuperMultipleModal" style="display: none;" aria-hidden="true">
	<div class="modal-dialog" id="uploadDialog" role="document" hx-target="this">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Add supervisor from FILE</h5>
				<button type="button" class="close btn btn-secondary" data-bs-dismiss="modal"><span>Ã—</span>
				</button>
			</div>
			<form method="post" enctype="multipart/form-data">
				<div class="modal-body">
					<p>Fill the form below to create multiple supervisor account.</p>
					<div id='form-errors'>{{ form_errors }}</div>
					{{ form3|crispy }}
					{% csrf_token %}
				</div>
				<div class="modal-footer">
					<button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
					<button type="submit" name="multiple" class="btn btn-success btn-block text-white">Create Account</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="modal fade" id="deleteUserModal" style="display: none;" aria-hidden="true">
	<div class="modal-dialog" id="deleteUser" role="document" hx-target="this">
	</div>
</div>

<script>
	var modal = new bootstrap.Modal(document.getElementById('deleteUserModal'))
	htmx.on('htmx:afterSwap', (e) => {
		if (e.detail.target.id === 'deleteUser'){
		modal.show();
	  }
	})

	htmx.on('htmx:beforeSwap', (e) => {
	  if (e.detail.target.id === 'deleteUser' && !e.detail.xhr.response){
		modal.hide();
		}
	})

</script>
{% endblock body %}
